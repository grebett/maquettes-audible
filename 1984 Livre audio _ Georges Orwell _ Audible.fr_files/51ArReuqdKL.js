(function(q){var u=window.AmazonUIPageJS||window.P,n=u._namespace||u.attributeErrors,v=n?n("AudibleWebAddressAndPaymentsAssets",""):u;v.guardFatal?v.guardFatal(q)(v,window):v.execute(function(){q(v,window)})})(function(q,u,n){function v(c,b){if(!(c instanceof b))throw new TypeError("Cannot call a class as a function");}function I(c,b){if(!c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?c:b}function G(c,b){if("function"!==
typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);c.prototype=Object.create(b&&b.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(c,b):c.__proto__=b)}function v(c,b){if(!(c instanceof b))throw new TypeError("Cannot call a class as a function");}function v(c,b){if(!(c instanceof b))throw new TypeError("Cannot call a class as a function");}function I(c,b){if(!c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?c:b}function G(c,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);c.prototype=Object.create(b&&b.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(c,b):c.__proto__=b)}function v(c,b){if(!(c instanceof b))throw new TypeError("Cannot call a class as a function");}q.when("image").register("issuerIconUtility",
function(c){function b(){var b=0<arguments.length&&arguments[0]!==n?arguments[0]:"";return f()[b]||{}}function f(){return u.adblCcIssuerIconsByImageTypeByIssuerName||{}}return{updateImage:function(d){var a=1<arguments.length&&arguments[1]!==n?arguments[1]:"",a="string"===typeof a?a:a&&"BankAccount"===a.paymentType?"BankAccount":a&&a.issuerName||"";"IMG"!==d.nodeName&&(d=d.querySelector("img"));var g=b(a);c.update(d,g.rasterImageSource,g.vectorImageSource);d.setAttribute("data-issuer-name",a)},getIssuerIconByIssuerName:b,
getIssuerIconsByIssuerName:f}});"use strict";var Y=function(){return function(c,b){if(Array.isArray(c))return c;if(Symbol.iterator in Object(c)){var f=[],d=!0,a=!1,g=n;try{for(var e=c[Symbol.iterator](),m;!(d=(m=e.next()).done)&&(f.push(m.value),!b||f.length!==b);d=!0);}catch(p){a=!0,g=p}finally{try{if(!d&&e["return"])e["return"]()}finally{if(a)throw g;}}return f}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}();q.when("AudiblejQuery","refMarkers","StrictEvents","paymentsWidget_scrollIntoView",
"modal","toastMessage","processing","button","AudibleValidator","paymentsWidgetAjax","PaymentsWidgetDialog","PaymentsWidgetPaymentInstrument","PaymentsWidgetAddress","focus","ready").register("paymentsWidget",function(c,b,f,d,a,g,e,m,p,k,l,z,B,t){function r(){Z===n&&(Z=b.getSlotNameFromElement(S));return Z}function M(x,a,b,e){if(x&&(x.redirectUrl||x.response&&x.response.redirectUrl))u.location.href=x.redirectUrl||x.response&&x.response.redirectUrl;else{a=x&&(x.message||x.response&&x.response.error&&
x.response.error.message)||a;var f=!1;b&&!/^(add|edit)/.test(h.getCurrentViewName())&&(!1===(x&&x.error&&x.error.paymentExists)?b.destroy():f=b.showError(a));f||((b=e.querySelector(".payments-widget-global-ajax-error"))?(c(b).removeClass("bc-pub-hidden").find(".payments-widget-error-text").text(a),d(b)):g(a));x&&x.response&&x.response.error&&x.response.error.failedFields&&x.response.error.failedFields.forEach(function(a){w.emit("_serverFieldError",{fieldName:a})})}}function Q(a,b){a&&!/^(add|edit)/.test(h.getCurrentViewName())&&
a.hideError();(a=b.querySelector(".payments-widget-global-ajax-error"))&&c(a).addClass("bc-pub-hidden")}function ca(a,b){var d=z.getDefault();k.setDefaultPayment(a,a.csrfToken,E(),r(),function(e,f){if(e){d&&d.data({isDefault:!1});a.data({isDefault:!0});w.emit("changeDefaultPayment",{paymentInstrument:a,oldPaymentInstrument:d});c(".adbl-is-default").removeClass("adbl-is-default").addClass("adbl-not-default");a.wrapper.classList.remove("adbl-not-default");a.wrapper.classList.add("adbl-is-default");
var t=f.response&&f.response.status&&f.response.status.message;t&&g(t);Q(a,A)}else M(f,N,a,A);b&&b(e,f)})}function v(a){C?(J.startLoading(),a(function(a,b,x){J.stopLoading();O(A,x,a,b)})):P(y,a)}function P(a,b){a.startLoading();var d=a.getContent(),c=a.getHeader();d.innerHTML="";c.innerHTML="";a.setHeight();a.startLoading();a.open();b(function(b,e,g){a.stopLoading();O(d,g,b,e,a);if(b=d.querySelector(".dialog-title-content"))c.innerHTML=b.innerHTML,a.setHeight()})}function O(a,b,d,c,e){c=c&&c.response||
{};c.htmlString&&(a.innerHTML=c.htmlString,e&&t.trapFocus(e.getDialogEl()),l.init(a));d&&(d=c&&c.status||{},d.message&&g(d.message),b&&(h.getCurrentWidgetName()===h.PAYMENTS_WIDGET_NAME?R=b:G=b),w.emit("renderView",{widgetName:h.getCurrentWidgetName(),viewName:h.getCurrentViewName(),viewElement:a}))}function D(a){P(H,function(b){k.getEditPaymentView(a&&a.data(),E({isDialog:!0}),r(),function(d,c){b(d,c,a&&a.paymentId?h.EDIT_PAYMENT_VIEW_NAME:h.ADD_PAYMENT_VIEW_NAME);d?(aa=a,Q(a,T||A)):M(c,ha,a,T||
A)})})}function U(a){k.deletePayment(a.data(),E({isDialog:!C}),r(),function(b,d){O(A,null,b,d,y);b?(w.emit("deletePayment",{paymentInstrument:a}),Q(a,A)):M(d,ia,a,A)})}function V(a,b){var d=H.isOpen()?H:y,e=d?d.getContent():A,g=c(e).find("form:visible");if(g.length)if(p.validateAll()){var f=K(g),t=E(),m=!a||!a.paymentId,g=g.find('[name\x3d"useAsDefault"]'),g={useAsDefault:!t.isMfaCase&&0===g.length||!0===g.prop("checked")},f=c.extend(a&&a.data(),f,g),B=d?d:J;B.startLoading();var l=h.getSelectedPaymentInstrument(),
M=!t.setDefaultOnSelect;k.editPayment(f,Object.assign(t,{isDialog:!C,selectPaymentOnSuccess:M}),r(),function(d,c){if(m){var g=c&&c.response&&c.response.status&&c.response.status.paymentId;g&&(a=z.getById(g,c.response.htmlString))}else a.reload(c&&c.response&&c.response.htmlString);var f=!0,g=function(){f=!1},t=!0,h=function(){t=!1},K=!0,r=function(){K=!1};b&&b(d,a,g,h,r);w.emit(m?"addPayment":"editPayment",{success:d,paymentInstrument:a,cancelUpdateUi:g,cancelStopLoader:h,cancelCloseDialog:r});da({success:d,
data:c,shouldUpdateUi:f,shouldCloseDialog:K,shouldStopLoader:t,paymentInstrument:a,loader:B,contentElement:e});d&&M&&w.emit("changeSelectedPayment",{paymentInstrument:a,oldPaymentInstrument:l})})}else b&&b(!1,a,function(){return null})}function W(a){var b=A,d=c(b).find("form:visible");if(d.length){p.validateAll()||a&&a(!1,null,function(){return null});var d=K(d),g=J;g.startLoading();k.addAddress(d,E({isDialog:!C}),r(),function(d,c){function e(){B=!1}function f(){l=!1}function t(){K=!1}var m=c&&c.response&&
c.response.status?c.response.status.addressId:null,B=!0,l=!0,K=!0;a&&a(d,m,e,f,t);w.emit("addAddress",{success:d,addressId:m,cancelUpdateUi:e,cancelStopLoader:f,cancelCloseDialog:t});da({viewName:h.VIEW_ADDRESS_VIEW_NAME,success:d,data:c,shouldUpdateUi:B,shouldCloseDialog:K,shouldStopLoader:l,loader:g,contentElement:b})})}}function K(a){var b=a.find(":input:disabled").prop("disabled",!1),d={};c.each(a.serializeArray(),function(a,b){d[b.name]=b.value||""});b.prop("disabled",!0);return d}function da(a){var b=
a.viewName,b=b===n?null:b,d=a.paymentInstrument,d=d===n?null:d,c=a.success,g=a.data,e=a.loader,f=a.contentElement,t=a.shouldUpdateUi,m=a.shouldCloseDialog,m=m===n?!0:m;a=a.shouldStopLoader;a=a===n?!0:a;if(t===n||t)c&&(m||h.getCurrentViewName()===h.EDIT_PAYMENT_WIDGET_NAME)&&h.closeCurrentDialog(),O(A,b,c,g,y);c?Q(d,f):M(g,ja,d,f);a&&e.stopLoading()}function E(a){var b=c(".payments-configuration").data();if(!b.setDefaultOnSelect){var d=h.getSelectedPaymentInstrument();d&&(b.selectedPaymentId=d.paymentId)}b.showClosePaymentsListButton=
I===h.SELECTED_PAYMENT_VIEW_NAME;return Object.assign(b,a)}function F(a,b){var d=a.split(/\s*,\s*/);X.on("click",d.map(function(a){return a+":not(.bc-button)"}).join(", "),b);X.on("click",d.map(function(a){return a+".bc-button button"}).join(", "),function(d){b.apply(c(this).closest(a).get(0),arguments)})}var h={},X=c(document),ea=void 0;q.when("tray").execute(function(a){return ea=a});h.PAYMENTS_WIDGET_NAME="paymentsWidget";h.EDIT_PAYMENT_WIDGET_NAME="editPaymentWidget";h.PAYMENTS_LIST_VIEW_NAME=
"paymentsList";h.MEMBERSHIP_BILLING_PAYMENTS_LIST_VIEW_NAME="membershipBillingPaymentsList";h.SELECTED_PAYMENT_VIEW_NAME="selectedPayment";h.ADD_PAYMENT_VIEW_NAME="addPayment";h.EDIT_PAYMENT_VIEW_NAME="editPayment";h.ADD_ADDRESS_VIEW_NAME="addAddress";h.VIEW_ADDRESS_VIEW_NAME="viewAddress";var ka=[h.ADD_PAYMENT_VIEW_NAME,h.EDIT_PAYMENT_VIEW_NAME,h.ADD_ADDRESS_VIEW_NAME],C=void 0,I=c("#payments-widget-current-view").data("currentView"),R=I,G=void 0,aa=void 0,y=void 0,A=void 0,J=void 0,L=void 0,T=void 0,
H=void 0,L=c("#genericErrorMessages"),N=L.data("default-set-failure"),ha=L.data("edit-fetch-failure"),ja=L.data("edit-failure"),ia=L.data("delete-failure"),w=new f("beforeChangeSelectedPayment changeSelectedPayment changeDefaultPayment addPayment addAddress editPayment deletePayment confirmSelectedPayment formIsValid _formIsValid formNotValid _formNotValid renderView _serverFieldError".split(" "));h.on=w.on.bind(w);h.off=w.off.bind(w);h._emit=w.emit.bind(w);h.isPaymentsWidgetDialogOpen=function(){return y&&
y.isOpen()};h.getCurrentWidgetName=function(){return H.isOpen()?h.EDIT_PAYMENT_WIDGET_NAME:C||y.isOpen()?h.PAYMENTS_WIDGET_NAME:null};h.getCurrentViewName=function(){switch(h.getCurrentWidgetName()){case h.PAYMENTS_WIDGET_NAME:return R;case h.EDIT_PAYMENT_WIDGET_NAME:return G;default:return null}};h.isFormView=function(){return-1<ka.indexOf(h.getCurrentViewName())};var fa=void 0;h.getSelectedPaymentInstrument=function(){if(R===h.PAYMENTS_LIST_VIEW_NAME||R===h.MEMBERSHIP_BILLING_PAYMENTS_LIST_VIEW_NAME){var a=
c('.payments-widget-valid [name\x3d"paymentInstrument_isSelected_radio"]').filter(":checked");if(a.length)return z.getByElement(a.get(0))}else if(R===h.SELECTED_PAYMENT_VIEW_NAME)return z.getByElement(A.querySelector(".payments-widget-payment-instrument"));return fa};w.on("confirmSelectedPayment",function(a,b){fa=b.paymentInstrument});h.getSelectedAddress=function(){var a=document.querySelector(".payments-widget-address");return a&&B.getByElement(a)};h.openPaymentsWidgetView=function(a,b){C||C||y.open();
v(function(d){function c(g,e,f){d(e,f,a);e?Q(g,A):M(f,"An unknown error occurred.",g,A);b&&b(e)}(function(){switch(a){case h.PAYMENTS_LIST_VIEW_NAME:k.getPaymentListView(E({isDialog:!C}),r(),function(a,b){c(null,a,b)});break;case h.MEMBERSHIP_BILLING_PAYMENTS_LIST_VIEW_NAME:k.getMembershipBillingPaymentListView(E({isDialog:!C}),r(),function(a,b){c(null,a,b)});break;case h.SELECTED_PAYMENT_VIEW_NAME:var b=h.getSelectedPaymentInstrument();k.getSelectedPaymentView(b&&b.data(),E({isDialog:!C}),r(),function(a,
d){b=h.getSelectedPaymentInstrument();c(b,a,d)});break;case h.ADD_ADDRESS_VIEW_NAME:k.getAddAddressView(E({isDialog:!C}),r(),function(a,b){c(null,a,b)});break;default:throw c(null,!1,null),new TypeError("Invalid view name: "+a);}})()})};h.closeCurrentDialog=function(){var a=H.isOpen()?H:y;a&&(y&&y!==a?y.open():a.close())};X.on("click","#paymentsWidgetAddAndEditDialog .bc-trigger.modal-close",function(a){a.preventDefault();y&&y.open()});h.closeAllDialogs=function(){var a=H.isOpen()?H:y;a&&a.close()};
h.startPaymentsWidgetLoader=function(){return J.startLoading()};h.stopPaymentsWidgetLoader=function(){return J.stopLoading()};h.startEditPaymentWidgetLoader=function(){return H.startLoading()};h.stopEditPaymentWidgetLoader=function(){return H.stopLoading()};h.savePayment=function(a){return V(aa,a)};h.saveAddress=function(a){return W(a)};var ga=!0;h.isEnabled=function(){return ga};var S=void 0,L=document.getElementById("paymentsWidgetDialog"),C=!L;if(L)y=new l(L),A=y.getContent(),J=y;else if(S=document.querySelector(".payments-widget-inline-wrapper"))A=
S.querySelector(".payments-widget-content"),f=e(S),J={startLoading:f.activate,stopLoading:f.deactivate};else return ga=!1,h;var T=document.getElementById("paymentsWidgetAddAndEditDialog"),H=new l(T),Z=void 0;w.on("_formIsValid",function(a,b){C&&h.getCurrentWidgetName()===h.PAYMENTS_WIDGET_NAME&&h.isFormView()&&w.emit("formIsValid",b)});w.on("_formNotValid",function(a,b){C&&h.getCurrentWidgetName()===h.PAYMENTS_WIDGET_NAME&&h.isFormView()&&w.emit("formNotValid",b)});(function(){var a=new URL(u.location.href),
b=void 0,d=!0,c=!1,g=n;try{for(var e=a.searchParams[Symbol.iterator](),f;!(d=(f=e.next()).done);d=!0){var t=Y(f.value,2),m=t[1];if("failedPaymentId"===t[0]){b=m;break}}}catch(h){c=!0,g=h}finally{try{!d&&e.return&&e.return()}finally{if(c)throw g;}}if(b){a={};d=!0;c=!1;g=n;try{for(var B=document.cookie.split(";")[Symbol.iterator](),l;!(d=(l=B.next()).done);d=!0){var K=l.value.trim().split("\x3d"),r=Y(K,2);a[r[0]]=r[1]}}catch(h){c=!0,g=h}finally{try{!d&&B.return&&B.return()}finally{if(c)throw g;}}B=
"failedPaymentId"+a["session-id"];l=[];a[B]&&(l=JSON.parse(JSON.parse(a[B])));l.push(b);l=Array.from(new Set(l));document.cookie=B+"\x3d"+JSON.stringify(JSON.stringify(l))+"; expires\x3d0; path\x3d/; domain\x3d.audible.com"}})();(function(){if(u.location.href&&document.referrer&&(-1===u.location.href.indexOf("/subscription/confirmation")||-1===document.referrer.indexOf("/subscription/confirmation")&&-1===u.location.href.indexOf("failedPaymentId"))){var a=!0,b=!1,d=n;try{for(var c=document.cookie.split(";")[Symbol.iterator](),
g;!(a=(g=c.next()).done);a=!0){var e=g.value.trim().split("\x3d"),f=Y(e,2)[0];if(-1!==f.indexOf("failedPaymentId")){document.cookie=f+"\x3d; expires\x3d0; path\x3d/; domain\x3d.audible.com";break}}}catch(t){b=!0,d=t}finally{try{!a&&c.return&&c.return()}finally{if(b)throw d;}}}})();F(".payments-widget-open-view-selected-payment",function(a){a.preventDefault();h.openPaymentsWidgetView(h.SELECTED_PAYMENT_VIEW_NAME)});F(".payments-widget-open-view-payments-list",function(a){a.preventDefault();h.openPaymentsWidgetView(h.PAYMENTS_LIST_VIEW_NAME)});
F(".payments-widget-close-main-dialog",function(a){a.preventDefault();y&&y.close()});F(".payments-widget-edit-payment",function(a){a.preventDefault();D(z.getByElement(this))});F(".payments-widget-add-payment",function(a){a.preventDefault();D()});F(".payments-widget-close-dialog",function(a){a.preventDefault();h.closeCurrentDialog();aa=null});F(".payments-widget-save-and-close",function(a){a.preventDefault();c('[name\x3d"paymentType"]').val()?h.savePayment():h.saveAddress()});F(".payments-widget-delete-confirm",
function(a){a.preventDefault();a=c(this).closest(".bc-modal").attr("id");a=document.querySelector('.payments-widget-payment-instrument [data-trigger\x3d"'+a+'"]');U(z.getByElement(a))});F(".delete-link, .default-delete",function(a){a=z.getByElement(this);var d="deleteModal",c="";a&&(c=a.index,a.isDefault&&(d="defaultDeleteModal"));b.buildAndPost(d,r(),c)});var ba=h.getSelectedPaymentInstrument();X.on("change",'.payments-widget-valid [name\x3d"paymentInstrument_isSelected_radio"]',function(b){function d(){ba=
e;w.emit("changeSelectedPayment",{paymentInstrument:e,oldPaymentInstrument:g})}var g=ba,e=z.getByElement(this),f=this,t=E().setDefaultOnSelect&&!c("#makePaymentDefault").length;w.emit("beforeChangeSelectedPayment",{paymentInstrument:e,oldPaymentInstrument:g,cancelSetDefault:function(){t=!1}});if(E().isMfaCase&&!e.isDefault){document.getElementById("newPaymentInstrumentId").value=e.paymentId;document.getElementById("csrfToken").value=e.csrfToken;c('.payments-widget-valid [name\x3d"paymentInstrument_isSelected_radio"]').prop("disabled",
!0);b=document.getElementById("mfaVerifyPaymentModal");var m=document.getElementById("mfaVerifyPaymentTray");b&&a.toggle(b);m&&ea.toggle(m)}else t&&!e.isDefault?function(){var a=c('.payments-widget-valid [name\x3d"paymentInstrument_isSelected_radio"]');a.prop("disabled",!0);ca(e,function(b,c){b?d():g?a.filter('[value\x3d"'+g.paymentId+'"]').prop("checked",!0):f.checked=!1;a.prop("disabled",!1)})}():d()});F("#mfa_verify_cancel",function(a){a=c('.payments-widget-valid [name\x3d"paymentInstrument_isSelected_radio"]');
a.prop("disabled",!1);a.filter('[value\x3d"'+ba.paymentId+'"]').prop("checked",!0)});F(".payments-widget-payment-instrument",function(a){a=c(a.target).parents().add(a.target);a.filter("a, button, input, textarea, .bc-trigger").length||c(a.filter("label").prop("control")).filter("a, button, input, textarea, .bc-trigger").length||(a=c(this).find('[name\x3d"paymentInstrument_isSelected_radio"]'),!a.length||a.prop("disabled")||a.prop("checked")||a.prop("checked",!0).trigger("change"))});F("#confirm-selection",
function(a){function b(){y&&!g&&y.close();var a=h.getSelectedPaymentInstrument();w.emit("confirmSelectedPayment",{paymentInstrument:a})}a=h.getSelectedPaymentInstrument();var d=c("#makePaymentDefault").prop("checked"),g=E().keepDialogOpenOnSuccess;a&&!a.isDefault&&d?(J.startLoading(),ca(a,function(a,d){J.stopLoading();a&&b()})):b()});w.on("changeSelectedPayment",function(a,b){(a=document.querySelector("#confirm-selection"))&&m.enable(a);a=c("#makePaymentDefault");a.prop("disabled")||a.prop("checked",
b.paymentInstrument.isDefault)});w.on("deletePayment",function(a,b){(a=h.getSelectedPaymentInstrument())&&a.paymentId===b.paymentInstrument.paymentId&&(b=document.querySelector("#confirm-selection"))&&m.disable(b)});return h});"use strict";var D=function(){function c(b,c){for(var d=0;d<c.length;d++){var a=c[d];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(b,a.key,a)}}return function(b,f,d){f&&c(b.prototype,f);d&&c(b,d);return b}}();q.when("PaymentsWidgetDataElement").register("PaymentsWidgetAddress",
function(c){function b(b){for(;b;){if(b.classList.contains("payments-widget-address"))return b;b=b.parentElement}return null}return function(c){function d(a){v(this,d);if(!a.classList.contains("payments-widget-address"))throw new TypeError("Invalid address wrapper");return I(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,a))}G(d,c);D(d,[{key:"getDataElement",value:function(){return this.wrapper.querySelector(".payments-widget-address-data")}},{key:"getId",value:function(){return this.addressId}},
{key:"_dataAttributesByJsKey",get:function(){return{addressId:{name:"data-address-id",type:"string"},accountHolderName:{name:"data-account-holder-name",type:"string"},customerName:{name:"data-customer-name",type:"string"},addressLine1:{name:"data-address-line-1",type:"string"},addressLine2:{name:"data-address-line-2",type:"string"},city:{name:"data-city",type:"string"},state:{name:"data-state",type:"string"},zip:{name:"data-zip",type:"string"},phoneNumber:{name:"data-phone-number",type:"string"}}}}],
[{key:"getById",value:function(a,b){return new d(d.getDataElementById(a,b))}},{key:"getByElement",value:function(a){return new d(b(a))}},{key:"getDataElementById",value:function(a,d){var c=document;d&&(c=document.createElement("div"),c.innerHTML=d);a=c.querySelector('[data-address-id\x3d"'+a+'"]');return b(a)}}]);return d}(c)});"use strict";q.when("AudiblejQuery","paymentsWidgetAjaxUtils","refMarkers").register("paymentsWidgetAjax",function(c,b,f){var d=(c=c(".payments-configuration").data())?c.ajaxEndpointPrefix:
"";return{getEditPaymentView:function(a,c,e,m){if("function"!==typeof m)throw new TypeError("missing onComplete function");var p="";a&&a.index&&(p=a.index);c.ref=f.build("getEdit",e,p);b.get("/payments/editform",Object.assign({},c,a),d,m)},getPaymentListView:function(a,c,e){if(null===a||a===n)throw new TypeError("missing viewArgs object");if("function"!==typeof e)throw new TypeError("missing onComplete function");a.ref=f.build("getList",c,"");b.get("/payments/listview",a,d,e)},getMembershipBillingPaymentListView:function(a,
c,e){if(null===a||a===n)throw new TypeError("missing viewArgs object");if("function"!==typeof e)throw new TypeError("missing onComplete function");a.ref=f.build("getListForMembershipBilling",c,"");b.get("/payments/membershipbillinglistview",a,d,e)},getSelectedPaymentView:function(a,c,e,m){if(null===a||a===n)throw new TypeError("missing paymentData object");if(null===c||c===n)throw new TypeError("missing viewArgs object");if("function"!==typeof m)throw new TypeError("missing onComplete function");
c.ref=f.build("getSel",e,"");b.get("/payments/selectedpayment",Object.assign({},c,a),d,m)},getAddAddressView:function(a,c,e){if(null===a||a===n)throw new TypeError("missing viewArgs object");if("function"!==typeof e)throw new TypeError("missing onComplete function");a.ref=f.build("getAddAddress",c,"");b.get("/payments/add-address",a,d,e)},deletePayment:function(a,c,e,m){if(null===a||a===n)throw new TypeError("missing paymentData object");if(null===c||c===n)throw new TypeError("missing viewArgs object");
if("function"!==typeof m)throw new TypeError("missing onComplete function");var p="";a&&a.index&&(p=a.index);c.ref=f.build("delete",e,p);b.post("/payments/delete",Object.assign({},c,a),d,m)},editPayment:function(a,c,e,m){if(null===a||a===n)throw new TypeError("missing paymentData object");if(null===c||c===n)throw new TypeError("missing viewArgs object");if("function"!==typeof m)throw new TypeError("missing onComplete function");var p="";a&&a.index&&(p=a.index);c.ref=f.build("edit",e,p);b.post("/payments/edit",
Object.assign({},c,a),d,m)},addAddress:function(a,c,e,m){if(null===a||a===n)throw new TypeError("missing addressData object");if(null===c||c===n)throw new TypeError("missing viewArgs object");if("function"!==typeof m)throw new TypeError("missing onComplete function");c.ref=f.build("address",e,"");b.post("/payments/address/add",Object.assign({},c,a),d,m)},setDefaultPayment:function(a,c,e,m,p){if(null===a||a===n||!a.paymentId)throw new TypeError("missing paymentData object");if(null===c||c===n)throw new TypeError("missing csrfToken");
if("function"!==typeof p)throw new TypeError("missing onComplete function");var k="";a&&a.index&&(k=a.index);e.ref=f.build("default",m,k);b.post("/payments/default",Object.assign({paymentId:a.paymentId,csrfToken:c},e),d,p)}}});"use strict";var N="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(c){return typeof c}:function(c){return c&&"function"===typeof Symbol&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c};q.when("ajax").register("paymentsWidgetAjaxUtils",
function(c){function b(b,g,p,k,l){if("string"!==typeof b)throw new TypeError("missing/invalid method");if("string"!==typeof g)throw new TypeError("missing/invalid url");if(p&&0>["object","string"].indexOf("undefined"===typeof p?"undefined":N(p)))throw new TypeError("invalid type for data (should be object or string)");if(l&&"function"!==typeof l)throw new TypeError("onComplete should be function");k&&(g=k+g);p="string"===typeof p?p:f(p);var z;a&&(g=d(g,a));null!==p&&("GET"===b?g=d(g,p):z=p);return c({method:b.toUpperCase(),
url:g,body:z},function(a,b){var c=!!String(a).match(/^2/),d=null;if(null!==a)if(null===b||b===n||""===b)d=null;else try{d=JSON.parse(b)}catch(e){d=b}l(c,d)})}function f(a){var b=null;if("string"===typeof a)b=a;else if(null!==a&&"object"===("undefined"===typeof a?"undefined":N(a)))for(var c in a)a.hasOwnProperty(c)&&(b=null===b?"":b+"\x26",b+=c+"\x3d"+encodeURIComponent(a[c]));return b}function d(a,b){var c=a.slice(-1);return"?"===c||"\x26"===c?a+b:a.match(/^.+\?.+$/)?a+"\x26"+b:a+"?"+b}var a="",g=
String(u.location.search).match(/\?.*(referrerPlatform=[^&]+)/);g&&(a+=g[1]+"\x26");(g=String(u.location.search).match(/\?.*(marketplaceId=[^&]+)/))&&(a+=g[1]+"\x26");(g=String(u.location.search).match(/\?.*(stringDebug=[^&]+)/))&&(a+=g[1]+"\x26");g=encodeURIComponent(u.location.href);a+="requestUrl\x3d"+g+"\x26";return{ajax:b,get:function(a,c,d,g){return b("GET",a,c,d,g)},post:function(a,c,d,g){return b("POST",a,c,d,g)},renderFormData:f,addUrlParams:d}});"use strict";D=function(){function c(b,c){for(var d=
0;d<c.length;d++){var a=c[d];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(b,a.key,a)}}return function(b,f,d){f&&c(b.prototype,f);d&&c(b,d);return b}}();q.register("PaymentsWidgetDataElement",function(){return function(){function c(b){v(this,c);if(!b)throw new TypeError("Missing data element wrapper");this.wrapper=b;this._load()}D(c,[{key:"reload",value:function(b){this._initDataElement(b);this._load()}},{key:"data",value:function(b){return b===
n?this._getData():this._setData(b)}},{key:"getDataElement",value:function(){throw"Not implemented!";}},{key:"getId",value:function(){throw"Not implemented!";}},{key:"_initDataElement",value:function(b){this.wrapper=this.constructor.getDataElementById(this.getId(),b)}},{key:"_getData",value:function(){var b={},c;for(c in this._dataAttributesByJsKey)this._dataAttributesByJsKey.hasOwnProperty(c)&&(b[c]=this[c]);return b}},{key:"_setData",value:function(b){this._initDataElement();var c=this.getDataElement(),
d;for(d in b)if(b.hasOwnProperty(d)){var a=this._getDataAttributeName(d);a&&c.setAttribute(a,b[d])}this._load()}},{key:"_getDataAttributeName",value:function(b){return(b=this._dataAttributesByJsKey[b])&&b.name}},{key:"_load",value:function(){var b=this.getDataElement(),c;for(c in this._dataAttributesByJsKey)if(this._dataAttributesByJsKey.hasOwnProperty(c)){var d=this._dataAttributesByJsKey[c],a=b.getAttribute(d.name);switch(d.type){case "boolean":a="true"===a}this[c]=a}}},{key:"destroy",value:function(){this.wrapper.parentElement&&
this.wrapper.parentElement.removeChild(this.wrapper)}},{key:"_dataAttributesByJsKey",get:function(){return null}}],[{key:"getById",value:function(){throw"Not implemented!";}}]);return c}()});"use strict";q.when("modal","processing","paymentsWidgetTrayHelper").execute(function(c,b,f){function d(a,d){q.register("PaymentsWidgetDialog",function(){var e=function(a){this.init(a)};e.prototype={init:function(a){if(null===a||a===n)throw new TypeError("missing el argument");this.el=a;this.setHeight=e.setHeight(this.el);
this._processing=b(this.getWrapper())},setHeight:function(){},toggle:function(){return e.toggle(this.el)},isOpen:function(){if(a){var b=this._getTrayEl();return b&&b.classList.contains("show-tray")}return(b=this._getModalEl())&&b.classList.contains("show")},open:function(){this.isOpen()||this.toggle()},close:function(){this.isOpen()&&(this.toggle(),this.stopLoading())},getHeader:function(){return e.getHeader(this.el)},getContentWrapper:function(){return e.getContentWrapper(this.el)},getContent:function(){return e.getContent(this.el)},
startLoading:function(){return this._processing.activate()},stopLoading:function(){return this._processing.deactivate()},getWrapper:function(){return a?this._getTrayEl():this._getModalContentEl()},_getTrayEl:function(){return this.el.classList.contains("bc-tray")?this.el:this.el.querySelector(".bc-tray")},_getModalEl:function(){return this.el.classList.contains("bc-modal")?this.el:this.el.querySelector(".bc-modal")},_getModalContentEl:function(){return this.el.querySelector(".bc-modal-content")},
getDialogEl:function(){return a?this._getTrayEl():this._getModalEl()}};e.trayOrModal=a?d:c;e.init=function(){a&&d.init.apply(d,arguments);c.init.apply(c,arguments)};e.toggle=e.trayOrModal.toggle;e.getHeader=function(b){return a?b.querySelector(".payments-widget-dialog-header"):b.querySelector(".bc-core-modal-title")};e.getContentWrapper=function(a){return a.querySelector(".payments-widget-dialog-content-wrapper")};e.getContent=function(a){return a.querySelector(".payments-widget-dialog-content")};
e.setHeight=function(b){return a?f.setHeight(b):function(){}};return e})}q.when("tray","mobile").execute(function(a){d(!0,a)});q.when("desktop").execute(function(a){d(!1,null)})});"use strict";q.when("live","AudibleValidator").execute(function(c,b){function f(c){if(c){var a=c.childNodes&&-1<c.selectedIndex&&c.children[c.selectedIndex].value,g=void 0;for(c=c.parentElement;c;){if(c.classList.contains("payments-widget-edit-payment-wrapper")){g=c;break}c=c.parentElement}c=g.querySelector(".payments-widget-credit-card-form");
var e=g.querySelector(".payments-widget-bank-account-form");switch(a){case "CreditCard":c.classList.remove("bc-pub-hidden");e.classList.add("bc-pub-hidden");break;case "BankAccount":e.classList.remove("bc-pub-hidden");c.classList.add("bc-pub-hidden");break;default:c.classList.remove("bc-pub-hidden"),e.classList.remove("bc-pub-hidden")}b.validateAll(g)}}c("change",".payments-widget-payment-type select",function(){f(this)});q.when("ready").execute(function(){return f(document.querySelector(".payments-widget-payment-type select"))})});
"use strict";D=function(){function c(b,c){for(var d=0;d<c.length;d++){var a=c[d];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(b,a.key,a)}}return function(b,f,d){f&&c(b.prototype,f);d&&c(b,d);return b}}();q.when("PaymentsWidgetDataElement","paymentsWidget_scrollIntoView").register("PaymentsWidgetPaymentInstrument",function(c,b){function f(b){for(;b;){if(b.classList.contains("payments-widget-payment-instrument"))return b;b=b.parentElement}return null}
return function(d){function a(b){v(this,a);if(!b.classList.contains("payments-widget-payment-instrument"))throw new TypeError("Invalid payment instrument wrapper");return I(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,b))}G(a,d);D(a,[{key:"getDataElement",value:function(){return this.wrapper.querySelector(".payments-widget-payment-data")}},{key:"getId",value:function(){return this.paymentId}},{key:"showError",value:function(a){if(this.wrapper){var c=this.getErrorElement();if(c)return this.wrapper.classList.add("payments-widget-error"),
c.querySelector(".payments-widget-error-text").innerText=a,c.classList.remove("bc-pub-hidden"),"none"===c.style.display&&(c.style.display=""),b(c),!0}return!1}},{key:"hideError",value:function(){if(this.wrapper){var a=this.getErrorElement();if(a)return this.wrapper.classList.remove("payments-widget-error"),a.classList.add("bc-pub-hidden"),!0}return!1}},{key:"getErrorElement",value:function(){return this.wrapper.querySelector(".payments-widget-payment-instrument-error")||this.getErrorSibling()}},{key:"getErrorSibling",
value:function(){return this.wrapper.nextElementSibling&&this.wrapper.nextElementSibling.classList.contains("payments-widget-payment-instrument-error")&&this.wrapper.nextElementSibling}},{key:"destroy",value:function(){var a=this.getErrorSibling();a&&a.parentElement&&a.parentElement.removeChild(a);c.prototype.destroy.apply(this,arguments)}},{key:"_dataAttributesByJsKey",get:function(){return{paymentId:{name:"data-payment-id",type:"string"},billingAddressId:{name:"data-billing-address-id",type:"string"},
paymentType:{name:"data-payment-type",type:"string"},tail:{name:"data-tail",type:"string"},accountHolderName:{name:"data-account-holder-name",type:"string"},isValid:{name:"data-is-valid",type:"boolean"},isDefault:{name:"data-is-default",type:"boolean"},issuerName:{name:"data-issuer-name",type:"string"},displayIssuerName:{name:"data-display-issuer-name",type:"string"},bankName:{name:"data-bank-name",type:"string"},csrfToken:{name:"data-csrf-token",type:"string"},index:{name:"data-index",type:"integer"}}}}],
[{key:"getById",value:function(b,c){return new a(a.getDataElementById(b,c))}},{key:"getByElement",value:function(b){return new a(f(b))}},{key:"getDataElementById",value:function(a,b){var c=document;b&&(c=document.createElement("div"),c.innerHTML=b);a=c.querySelector('[data-payment-id\x3d"'+a+'"]');return f(a)}},{key:"getDefault",value:function(){var b=document.querySelector('[data-is-default\x3d"true"]');return b?a.getByElement(b):null}}]);return a}(c)});"use strict";q.when("AudiblejQuery","paymentsWidget",
"AudibleValidator","ready").execute(function(c,b,f){function d(a){return document.querySelector('[name\x3d"'+a+'"]')}function a(a){if(a=d(a))a.classList.add("payments-widget-server-error-field"),a.setAttribute(z,a.value)}function g(a){if(a=d(a))a.classList.add("adbl-field-error"),(a=p(a))&&a.classList.remove("bc-pub-hidden")}function e(a){if(a=d(a))a.classList.remove("adbl-field-error"),(a=p(a))&&a.classList.add("bc-pub-hidden")}function m(a){return(a=d(a))&&a.hasAttribute(z)?String(a.value)!==String(a.getAttribute(z)):
!0}function p(a){return a.nextElementSibling&&a.nextElementSibling.classList.contains("payments-widget-invalid-error")&&a.nextElementSibling}var k=c(document),l=[{serverErrorFields:["zipCode","state"],highlightFields:["zipCode","state"],dismissOnChangeFields:["country","zipCode","state"]}];b.on("_serverFieldError",function(b,e){if(b=d(e.fieldName)){var r=p(b);!r&&(r=document.getElementById("adbl_paymentswidget_invalid_error"))&&(r=r.cloneNode(!0),r.id="",b.parentNode.insertBefore(r,b.nextSibling));
(r=l.find(function(a){return-1<a.serverErrorFields.indexOf(e.fieldName)}))?(r.highlightFields.forEach(function(a){return g(a)}),r.dismissOnChangeFields.forEach(function(b){return a(b)})):(g(e.fieldName),a(e.fieldName));f._addSaveBlocker(c(b),"server-error")}});k.on("input change","input, select, textarea",function(a){var b=this.getAttribute("name");if(b&&this.classList.contains("payments-widget-server-error-field"))if(a=l.find(function(a){return-1<a.dismissOnChangeFields.indexOf(b)}))r=a.dismissOnChangeFields.every(function(a){return!m(a)}),
a.highlightFields.forEach(function(a){r?(g(a),f._addSaveBlocker(c(d(a)),"server-error")):(e(a),f._removeSaveBlocker(c(d(a)),"server-error"))});else{var r=!m(b);r?g(b):e(b);r?f._addSaveBlocker(c(this),"server-error"):f._removeSaveBlocker(c(this),"server-error")}});var z="data-payments-widget-error-initial-value"});"use strict";q.when("debounce").register("paymentsWidgetTrayHelper",function(c){return{setHeight:function(b){b=b||document;return c(function(){var c=0,d=u.innerHeight||document.documentElement.clientHeight||
document.body.clientHeight,a=b.querySelectorAll(".tray-fixed");[].forEach.call(a,function(a,b){c+=a.offsetHeight});a=b.querySelector(".tray-wrapper");a.style.maxHeight="none";a.style.height=d-c+"px"})}}});"use strict";(function(){"function"!=typeof Object.assign&&(Object.assign=function(c,b){if(null==c)throw new TypeError("Cannot convert undefined or null to object");for(var f=Object(c),d=1;d<arguments.length;d++){var a=arguments[d];if(null!=a)for(var g in a)Object.prototype.hasOwnProperty.call(a,
g)&&(f[g]=a[g])}return f});Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(c,b){if(null==this)throw new TypeError('"this" is null or not defined');var f=Object(this),d=f.length>>>0;if("function"!==typeof c)throw new TypeError("predicate must be a function");for(var a=0;a<d;){var g=f[a];if(c.call(b,g,a,f))return g;a++}return n}})})();"use strict";q.when("focus","paymentsWidget","refMarkers","live","modal").execute(function(c,b,f,d,a){function g(b){if(!b)throw Error("No trigger button!");
var c=b.getAttribute("data-action-ref-marker-feature-code"),d=void 0;c&&(d=b.getAttribute("data-action-ref-marker-counter"),d=f.build(c,b,d));c=b.getAttribute("data-action");switch(c){case "trigger":var c=d,d=b.getAttribute("data-trigger-type"),g=b.getAttribute("data-trigger-id"),g=document.getElementById(g);if("modal"===d)a.toggle(g);else if("tray"===d)m.toggle(g);else throw Error('Invalid dialog type "'+d+'"');e(b,g);f.post(c);break;case "redirect":c=d;b=b.getAttribute("data-url");if(!b)throw Error('Invalid url "'+
b+'"');c&&(p.test(b)?b=b.replace(p,"$1"+c):(d=b.indexOf("?"),-1<d&&(b=b.slice(0,d)+"/ref\x3d"+c+b.slice(d))));u.location=b;break;case "formsubmit":c=(b=b.getAttribute("data-form-id"))&&document.getElementById(b);if(!c)throw Error('Invalid form "'+b+'"');c.submit();break;default:throw Error('Invalid action "'+c+'"');}}function e(a,b){!a.getAttribute("data-shift-focus")&&b&&(a=b.querySelector(c.FOCUSABLE_SELECTOR))&&c.change({focusElement:a,isFocusOnLayer:!0})()}var m=void 0;q.when("tray").execute(function(a){return m=
a});var p=/((?:\/|\?|&)ref=)[^?&]+/,k=null;d("click",".account-details-require-valid-payment-then-action",function(a){null===k&&(k="true"===this.getAttribute("data-has-valid-payment"));if(k)g(this);else{if(a=this.getAttribute("data-payments-widget-ref-marker-feature-code")){var c=this.getAttribute("data-payments-widget-ref-marker-counter");f.buildAndPost(a,this,c)}b.openPaymentsWidgetView(b.PAYMENTS_LIST_VIEW_NAME);e(this,document.getElementById("paymentsWidgetDialog"))}});b.on("addPayment",function(a,
c){c.success&&(k=!0,b.isPaymentsWidgetDialogOpen()&&(a=document.querySelector(".account-details-require-valid-payment-then-action")))&&(c.cancelUpdateUi(),g(a))});b.on("confirmSelectedPayment",function(a,b){k=!0;(a=document.querySelector(".account-details-require-valid-payment-then-action"))&&g(a)})});"use strict";q.when("AudiblejQuery").execute(function(c){c(document).on("click","#sepa-mandate-print",function(){c(document.body).addClass("sepa-printing");c(".ui-it-header-logo").addClass("show-for-printing");
c(".hide-for-printing").addClass("bc-pub-hidden");u.print();c(".hide-for-printing").removeClass("bc-pub-hidden")})});"use strict";q.register("addressUtility",function(){var c={US:/^\d{5}([\-]\d{4})?$/,CA:/^[ABCEGHJKLMNPRSTVXYabceghjklmnprstvxy]{1}\d{1}[A-Za-z]{1} *\d{1}[A-Za-z]{1}\d{1}$/,AU:/^\d{4}$/,GB:/^[a-zA-Z0-9 ]{6,8}$/,DE:/^\d{5}$/,FR:/^\d{5}$/,NZ:/^\d{4}$/,AT:/^\d{4}$/,BR:/^\d{5}[\-]\d{3}$/,DEFAULT:/^[A-Za-z\d\s-]{1,20}$/},b=/^\s*[\d\s\-.\(\)\+]*\s*$/;return{isValidPostalCode:function(b,d){d=
d.trim().toUpperCase();return(c[b]||c.DEFAULT).test(d)},isValidPhoneNumber:function(c){if(!c)return!0;if(!b.test(c))return!1;c=c.replace(/\D/g,"");return 9<=c.length&&20>c.length}}});"use strict";D=function(){function c(b,c){for(var d=0;d<c.length;d++){var a=c[d];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(b,a.key,a)}}return function(b,f,d){f&&c(b.prototype,f);d&&c(b,d);return b}}();q.when("button","debounce","paymentsWidget_scrollIntoView","AudiblejQuery",
"ready").register("AudibleValidator",function(c,b,f,d){function a(a){return d(a).not(d(".bc-pub-hidden "+a+", .bc-pub-hidden"+a))}var g=d(document),e=/^#/,m=0,p=[],k=void 0,l=function(){function b(a,c,d,e){v(this,b);this.validator=a;this.triggerEvent=c;this.$wrapper=d;this.displayError=e;this.validationId=this.getValidationId();this.isDuplicateValidation()||(this.isValid=this.validate())}D(b,[{key:"isDuplicateValidation",value:function(){var a=void 0;this.triggerEvent&&this.triggerEvent.originalEvent&&
(a=this.triggerEvent.originalEvent._adblValidationsById=this.triggerEvent.originalEvent._adblValidationsById||{});if(a){var b=a[this.validationId]=a[this.validationId]||0;this.displayError&&a[this.validationId]++;if(1<b)return!0}return!1}},{key:"validate",value:function(){var a=this.getField().val(),a=this.validator._isValid(a,this.getField(),this.$wrapper);this.blockSave(a);a?this.hideError():this.displayError?this.showError():this.deferError();return a}},{key:"blockSave",value:function(a){if(this.validator.blockSaveOnFail){var b=
this.getField(),c=this.validationId;a=!a;if(!b||"boolean"!==typeof a)throw new TypeError("Invalid arguments to blockSave()");a?z._addSaveBlocker(b,c):z._removeSaveBlocker(b,c)}}},{key:"showError",value:function(){if(!this.fieldHasError()||this.fieldHasErrorFromThisValidator())this.getError().removeClass("bc-pub-hidden"),this.$wrapper.addClass("adbl-error-state"),this.getField().attr("aria-invalid","true"),this.addErrorId(),this.removeDeferredError(),this.addCurrentFieldError()}},{key:"hideError",
value:function(){this.fieldHasErrorFromThisValidator()&&(this.getError().addClass("bc-pub-hidden"),this.$wrapper.removeClass("adbl-error-state"),this.getField().attr("aria-invalid","false"),this.removeDeferredError(),this.removeCurrentFieldError())}},{key:"deferError",value:function(){this.$wrapper.addClass("adbl-deferred-error-state");this.getError().addClass("adbl-deferred-error");this.addCurrentFieldError()}},{key:"addErrorId",value:function(){var a=this.getError();if(a.length){var b=this.getField();
if(b.length&&!b.attr("aria-describedby")){var c=a.prop("id");c||(c=this.getFieldId()+"_error",a.prop("id",c));b.attr("aria-describedby",c)}}}},{key:"getCurrentFieldErrorValidationId",value:function(){return this.$wrapper.data("data-adbl-current-field-error")}},{key:"fieldHasError",value:function(){var a=this.getCurrentFieldErrorValidationId();return null!==a&&a!==n}},{key:"fieldHasErrorFromThisValidator",value:function(){return this.validationId===this.getCurrentFieldErrorValidationId()}},{key:"addCurrentFieldError",
value:function(){this.$wrapper.data("data-adbl-current-field-error",this.validationId)}},{key:"removeCurrentFieldError",value:function(){this.$wrapper.data("data-adbl-current-field-error",null)}},{key:"removeDeferredError",value:function(){this.$wrapper.removeClass("adbl-deferred-error-state");this.getError().removeClass("adbl-deferred-error")}},{key:"getField",value:function(){var b=this.$wrapper.find(this.validator.fieldSelector);b.length||(b=this.$wrapper.filter(this.validator.fieldSelector));
!b.length&&e.test(this.validator.fieldSelector)&&(b=a(this.validator.fieldSelector));return b}},{key:"getError",value:function(){var b=this.$wrapper.find(this.validator.errorSelector);!b.length&&e.test(this.validator.errorSelector)&&(b=a(this.validator.errorSelector));return b}},{key:"getValidationId",value:function(){return this.getFieldId()+"_"+this.validator.validatorId}},{key:"getFieldId",value:function(){var a=this.validator.fieldId;a===n&&(a=this.getField().attr("id"));a||(a=this.$wrapper.attr("id"));
a||(a=this.getField().attr("name"));a||(a="field_"+m++);return a}}]);return b}(),z=function(){function b(a,c,e,f){v(this,b);if("string"!==typeof a||"string"!==typeof c||"function"!==typeof e)throw new TypeError("Invalid arguments for Validator constructor");this.wrapperSelector=a;this.errorSelector=c;this.isValidCallback=e;f=f||{};this.triggerValidationEvent=f.triggerValidationEvent||"input blur";this.fieldSelector=f.fieldSelector||"input, select, textarea";this.blockSaveOnFail=!1!==f.blockSaveOnFail;
this.fieldId=f.fieldId;this.validatorId=f.validatorId||"validator_"+m++;this.deferErrors=!1!==f.deferErrors;p.push(this);var k=this;g.on("adbl.validate",this.wrapperSelector,function(a){k._validate(a,d(this),!0)});g.on("adbl.validate-deferred",this.wrapperSelector,function(a){k._validate(a,d(this),!1)});var l=[];this.fieldSelector.split(/,\s*/).forEach(function(a){l.push(this.wrapperSelector+" "+a)},this);l=l.join(", ");g.on(this.triggerValidationEvent,l,function(a){k._validate(a,d(this).closest(k.wrapperSelector),
!0)});if("input blur"!==this.triggerValidationEvent)g.on("input blur",l,function(a){var b=d(this).closest(k.wrapperSelector);k._hasError(b)&&k._validate(a,b,!0)});g.on("input blur",l,function(a){k._validate(a,d(this).closest(k.wrapperSelector),!1)});d(function(){return k.validateAll()})}D(b,[{key:"validateAll",value:function(b,c){if(null===c||c===n)c=this.deferErrors;var e=this,g=void 0,g=b?d(b).find(e.wrapperSelector):a(e.wrapperSelector),f=!0;g.length?g.each(function(){e._validate(null,d(this),
!c)||(f=!1)}):k(!a(".adbl-save-blocker").length);return f}},{key:"_validate",value:function(a,b,c){return(new l(this,a,b,c)).isValid}},{key:"_hasError",value:function(a){return a.hasClass("adbl-error-state")}},{key:"_isValid",value:function(a,b,c){a=this.isValidCallback(a,b,c);if("boolean"!==typeof a)throw new TypeError("isValid must return a boolean");return a}}],[{key:"create",value:function(a,c,d,e){return new b(a,c,d,e)}},{key:"validate",value:function(a,b){a=d(a);a.length&&a.trigger(b?"adbl.validate":
"adbl.validate-deferred")}},{key:"validateAll",value:function(a,b){var c=!0;p.forEach(function(d){d.validateAll(a,b)||(c=!1)});return c}},{key:"clearState",value:function(){d(".adbl-save-blocker").removeClass("adbl-save-blocker")}},{key:"init",value:function(a){b.clearState();b.validateAll(a)}},{key:"_addSaveBlocker",value:function(a,b){k(!1);a.each(function(){var a=d(this),c=a.attr("adblFieldBlockers")||"";-1===c.indexOf(b)&&(a.addClass("adbl-save-blocker"),c+=","+b,a.attr("adblFieldBlockers",c))})}},
{key:"_removeSaveBlocker",value:function(b,c){b.each(function(){var b=d(this),e=b.attr("adblFieldBlockers");e&&(e=e.replace(","+c,""));b.attr("adblFieldBlockers",e);e||(b.removeClass("adbl-save-blocker"),k(!a(".adbl-save-blocker").length))})}}]);return b}(),k=b(function(a){var b=document.querySelector(".adbl-save-button");a?(b&&c.enable(b),g.trigger("AudibleValidator.formIsValid")):(b&&c.disable(b),g.trigger("AudibleValidator.formNotValid"))});g.on("click",".adbl-save-button",function(b){b.preventDefault();
z.validateAll(null,!1)||(b=a(".adbl-error-state").get(0),f(b))});return z});"use strict";q.when("AudiblejQuery","AudibleValidator","paymentsWidget","addressUtility","paymentUtility","issuerIconUtility").execute(function(c,b,f,d,a,g){function e(a){return a.closest("form")}function m(a){return!a||!u.adblCreditCardIssuerNamesWithoutExpirationDate||0>u.adblCreditCardIssuerNamesWithoutExpirationDate.indexOf(a)}function p(a,d,e){d===V&&e===W||c.ajax({url:G,method:"GET",dataType:"json",data:{countryCode:d,
postalCode:e},success:function(d){var e=0<a.find(N).length;if(!d||!d.city||!d.state&&e)U(d);else{var g=d.city,f=c.trim(d.state).toUpperCase();b.validate(a.find(O).val(g));e&&(d=a.find(N).find("option").each(function(){var a=c(this);if(c.trim(a.text()).toUpperCase()===f||a.val().toUpperCase()===f)return a.prop("selected",!0).trigger("change"),!1}).end(),b.validate(d.get(0),!1))}},error:function(a,b,c){return U(c)}})}function k(a){var b=a.find(".payments-widget-country-dropdown select").val();if(u.adblCountriesThatSupportAddressValidation&&
-1<u.adblCountriesThatSupportAddressValidation.indexOf(b)){var c=a.find(P).find("input").val();d.isValidPostalCode(b,c)&&p(a,b,c);W=c}V=b}var l=c(document),n=c(".payments-configuration").data(),n=n?n.ajaxEndpointPrefix:"";f.on("renderView",function(a,c){b.init(c.viewElement)});l.on("AudibleValidator.formIsValid",function(){f._emit("_formIsValid")});l.on("AudibleValidator.formNotValid",function(){f._emit("_formNotValid")});var q=function(a,b,d){var e=!1;b.each(function(){if(!c(this).val())return e=
!0,!1});e&&!d.find(".adbl-required-error").length&&(a=c("#adbl_paymentswidget_required_error"),a.length&&a.clone().removeAttr("id").appendTo(d));return!e};b.create(".adbl-required-field",".adbl-required-error",q);b.create(".adbl-slow-required-field",".adbl-required-error",q,{triggerValidationEvent:"blur"});var t="",r=!1,v=/[^a-z0-9]/gi,D=/(\w{4}(?=.))/g;l.on("keydown",".payments-widget-credit-card-number input",function(a){var b=c(this);a=a.target.selectionStart;b=b.val();t=b.replace(v,"");r=" "===
b.charAt(a)}).on("input",".payments-widget-credit-card-number input",function(d){var f=c(this),k=d.target,l=k.selectionStart,h=f.val();d=t.replace(D,"$1 ");var p=0;1<h.length-d.length&&(p=h.length-d.length);if(h.replace(v,"")===t)f.val(d),k.selectionEnd=l;else{d=e(f);var n=h.replace(v,""),q=n.length-t.length;1<q&&(0===(l-p)%4&&(l+=1),l=l+Math.floor(q/4)-(p-q),2===l-q%5||3===l-q%5&&3===p%4)&&(l+=1);if(r&&n.length>t.length||l===h.length&&4<n.length&&1===n.length%4)l+=1;f.val(n.replace(D,"$1 "));k.selectionEnd=
l;r=!1;f="";6<=n.length&&(f=a.getCcIssuerName(n));k=d.find(".payments-widget-credit-card-number").find(".adbl-issuer-icon");g.updateImage(k.get(0),f);k=d.find(".payments-widget-expiration-month select, .payments-widget-expiration-year select");f=!m(f);f!==k.prop("disabled")&&(k.prop("disabled",f),f&&k.each(function(){c(this).val("")}),b.validateAll(d.find(".payments-widget-expiration-date")))}});b.create(".payments-widget-credit-card-number",".payments-widget-credit-card-issuer-not-accepted-error",
function(b,c,d){b=b.replace(v,"");if(!b)return!0;c=a.getCcIssuerName(b);return null!==c&&a.isValidCcNumber(b,c)},{triggerValidationEvent:"blur"});b.create(".payments-widget-expiration-date",".payments-widget-expired-credit-card-error",function(b,c,d){a:{b=e(d);if(c=(b.find(".payments-widget-credit-card-number input").val()||"").replace(v,""))if(c=a.getCcIssuerName(c),!m(c)){b=!1;break a}c=b.find(".payments-widget-expiration-month select").val();b=b.find(".payments-widget-expiration-year select").val();
c=parseInt(c,10)-1;b=parseInt(b,10);d=new Date;b=b<d.getFullYear()||b===d.getFullYear()&&c<d.getMonth()}return!b},{triggerValidationEvent:"change",deferErrors:!!u.adblAccountDetailsIsNewCard});b.create(".payments-widget-expiration-field",".adbl-required-error",function(b,c,d){var f=(e(d).find(".payments-widget-credit-card-number input").val()||"").replace(v,"");return f&&(f=a.getCcIssuerName(f),!m(f))?!0:q(b,c,d)});var I="/payments/countries/subs",G="/payments/address/lookup";n&&(I=n+I,G=n+G);l.on("change",
".payments-widget-country-dropdown select",function(a){a=c(this);var d=a.val(),f=e(a);c.ajax({url:I,method:"GET",dataType:"json",data:{countryCode:d},success:function(a){a&&a.response&&a.response.htmlString?(b.validate(f.find(".payments-widget-geo-sub-dropdown-container").html(a.response.htmlString)),f.find(".payments-widget-geo-sub-dropdown-error").addClass("bc-pub-hidden"),k(f)):f.find(".payments-widget-geo-sub-dropdown-error").removeClass("bc-pub-hidden")},error:function(a,b,c){return f.find(".payments-widget-geo-sub-dropdown-error").show()}})});
var P=".payments-widget-postal-code",O=".payments-widget-billing-city",N=".payments-widget-geo-sub-dropdown select",U=function(a){console.error("ajax error looking up address ["+G+"]: "+("string"===typeof a?a:a&&(a.error||a.message)||"unknown error"))},V=void 0,W=void 0;l.on("input",P,function(){k(e(c(this)))});b.create(P,".payments-widget-invalid-postal-code-error",function(a,b,c){b=e(c).find(".payments-widget-country-dropdown select").val();return a&&b?!u.adblCountriesThatSupportAddressValidation||
0>u.adblCountriesThatSupportAddressValidation.indexOf(b)?!0:d.isValidPostalCode(b,a):!0},{triggerValidationEvent:"blur"});b.create(".payments-widget-phone-number",".payments-widget-invalid-phone-number-error",function(a){return d.isValidPhoneNumber(a)},{triggerValidationEvent:"blur"})});"use strict";q.register("paymentUtility",function(){function c(a){for(var b in f)if(f[b].test(a))return b;return null}function b(a){return!a||-1<d.indexOf(a)}var f={AmericanExpress:/^3[47]/,DinersClub:/^3(0[0-5]|[68][0-9])/,
Discover:/^6(011|4[456789]|5)/,enRoute:/^(2014|2149)/,JapanCreditBureau:/^(2131|1800|35)/,Maestro:/^(5[0678]|6304|6390|67)/,MasterCard:/^(5[1-5]|2[2-7])/,Visa:/^4/,AmazonPLCC:/^604578/},d=u.adblAllowedCreditCardIssuerNames,a={AmericanExpress:/^3[47][0-9]{13}$/,DinersClub:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,Discover:/^6(?:011|5[0-9]{2})[0-9]{12}$/,enRoute:/^(2014|2149)/,JapanCreditBureau:/^(?:2131|1800|35\d{3})\d{11}$/,Maestro:/(?:(?:5[0678]\\d\\d|6304|6390|67\\d\\d)\\d{8,15})/,MasterCard:/^5[1-5][0-9]{14}$/,
Visa:/^4[0-9]{12}(?:[0-9]{3})?$/,AmazonPLCC:/^604578[0-9]{10}/};return{getCcIssuerName:c,isValidCcIssuer:b,isValidCcNumber:function(d,e){return a[e].test(d)?b(c(d)):!1}}});"use strict";q.register("paymentsWidget_scroll",function(){function c(b){return.5>b?4*b*b*b:(b-1)*(2*b-2)*(2*b-2)+1}return function(b,f,d,a){function g(){var d=+new Date-n;d>=a?b.scrollTop=f:(b.scrollTop=Math.round(c(d/a)*m+e),setTimeout(g))}f=Math.min(Math.round(f),b.scrollHeight-(b===(document.scrollingElement||document.documentElement)?
u.innerHeight||document.documentElement.clientHeight||document.body.clientHeight:b.clientHeight));if(!1===d)b.scrollTop=f;else{a=a||300;var e=b.scrollTop,m=f-e,n=+new Date;g()}}});"use strict";q.when("paymentsWidget_scroll").register("paymentsWidget_scrollIntoView",function(c){function b(a){return"auto"===a||"scroll"===a}function f(a,b){return u.getComputedStyle?u.getComputedStyle(a,null).getPropertyValue(b):a.style[b]}var d=document.scrollingElement||document.documentElement;return function(a,g){g=
!1!==g;var e;a:if(e=a,e instanceof HTMLElement){for(;e&&e!==document;){var m=e;if(b(f(m,"overflow"))||b(f(m,"overflow-y"))||b(f(m,"overflow-x")))break a;e=e.parentNode}e=d}else e=void 0;var n;e!==d&&(n=e.style.position,e!==d&&0>["absolute","fixed","relative"].indexOf(n)&&(e.style.position="relative"));for(var m=a.offsetTop,k=a;k.offsetParent;){k=k.offsetParent;if(e===d){if(k===document.body||k===document.documentElement)break}else if(k===e)break;m+=k.offsetTop}k=0;if(e===d){var l=document.querySelector(".bc-nav-mobile-header");
l&&(k=l.clientHeight)}if(m<e.scrollTop+k)c(e,m-k,g);else{for(l=a;l&&!l.clientHeight;)l=l.parentNode;var l=m+(l&&l.clientHeight||0),q=e===d?u.innerHeight||document.documentElement.clientHeight||document.body.clientHeight:e.clientHeight;l>e.scrollTop+q-0&&(a.offsetHeight>q-k-0?c(e,m-k,g):c(e,l-q-0,g))}e!==d&&(e.style.position=n||null)}})});
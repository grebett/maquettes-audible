!function(){var e,t=new r,o="identity-resolver.api.kochava.com";if("undefined"!=typeof window){var n=window.kochava;window.kochava=t}function r(){e=this}r.prototype.init=function(t,o,n){if(e.startTime=t,e.appID=o,e.page_name=c(),e.verbose=n||!1,"undefined"!=typeof console&&void 0!==console.log?e.logging=!0:e.logging=!1,null!=o&&""!=o){e.utm=g("ko_click_id",o+"_click");var r=g("kv_id","kv_id");e.kvID=""==r?h():r,""==r&&e.install()}},r.prototype.identify=function(t,o){var n;if(""!=(n="string"==typeof t?JSON.stringify({custom_id:t}):JSON.stringify(t)||"")?(e.customTraits=n,f("c_trt",e.customTraits)):e.customTraits=v("c_trt"),""!=e.customTraits)try{var r={method:"POST",endpoint:"web-sdk.control.kochava.com/v1/cpi/identityLink.php",body:e.getIdentityPayload(e.customTraits),contentType:"application/json",retries:10,async:!0};e.verbose&&e.logging&&console.log("kochava.identify request: ",r),a(r,o)}catch(t){e.verbose&&e.logging&&console.log("kochava.identify error: ",t.message)}},r.prototype.submitCookieId=function(t,n,r,i,c,s){try{var l={method:"POST",endpoint:o+"/cookie/submit",body:{partner_cookie_id:t},contentType:"application/json",retries:10,async:c,appGuid:n,authCode:i,nonce:r,withCredentials:!0,secure:!0};e.verbose&&e.logging&&console.log("kochava.submitCookieId request: ",l),a(l,s)}catch(t){e.verbose&&e.logging&&console.log("kochava.submitCookieId error: ",t.message)}},r.prototype.getCookieId=function(t,n,r){try{var i={method:"GET",endpoint:o+"/cookie/retrieve",contentType:"application/json",retries:10,async:n,appGuid:t,withCredentials:!0,secure:!0};e.verbose&&e.logging&&console.log("kochava.getCookieId request: ",i),a(i,r)}catch(t){e.verbose&&e.logging&&console.log("kochava.getCookieId error: ",t.message)}},r.prototype.getMAID=function(t,n,r,i,c){try{var s={method:"GET",endpoint:o+"/maid/get",contentType:"application/json",retries:10,async:i,appGuid:t,authCode:r,nonce:n,withCredentials:!0,secure:!0};e.verbose&&e.logging&&console.log("kochava.getMAID request: ",s),a(s,c)}catch(t){e.verbose&&e.logging&&console.log("kochava.getMAID error: ",t.message)}},r.prototype.activity=function(t,o,n){t=t||"";try{var r={method:"POST",endpoint:"web-sdk.control.kochava.com/track/json",body:e.getPayload(t,o),contentType:"application/json",retries:10,async:!0};e.verbose&&e.logging&&console.log("kochava request: ",r),a(r,n)}catch(t){e.verbose&&e.logging&&console.log("kochava error: ",t.message)}},r.prototype.page=function(t,o,n){e.page_name=t||e.page_name,e.activity("page",o,n)},r.prototype.conversion=function(t,o,n){t=t||"",e.activity("conversion_"+t,o,n)},r.prototype.install=function(t){e.activity("install",null,t)},r.prototype.getPayload=function(t,o){o=o||{};var n={kochava_app_id:e.appID,kochava_device_id:e.kvID,sdk_version:"2.0.0",data:{language:l(),device_orientation:d(),user_agent:s(),device_ids:{kochava_device_id:e.kvID}}};if("install"==t)n.action="install";else if(n.action="event",n.data.event_name=t,n.data.event_data={page_name:e.page_name},"object"==typeof o)for(key in o)o.hasOwnProperty(key)&&(n.data.event_data[key]=o[key]);else null!=o&&e.verbose&&e.logging&&console.log("Unexpected type of options_array");if("page"!=t&&"install"!=t){var r=(new Date).getTime()-e.startTime;n.data.event_data.time_on_page=Math.round(r/1e3)}var i=u(),a=p();return null!=i&&(n.data.disp_w=i),null!=a&&(n.data.disp_h=a),"string"==typeof e.utm&&""!=e.utm&&(n.data.conversion_data={},n.data.conversion_data.utm_source=e.utm),n},r.prototype.getIdentityPayload=function(t){var o={kochava_app_id:e.appID,device_id:{kochava_device_id:e.kvID}};if(""!=t)try{o.data=JSON.parse(t)}catch(t){e.verbose&&e.logging&&console.log("Error parsing custom_trait JSON: ")}return o};var i,a=function(t,o){var n=t.method||"GET",r=t.endpoint,i=t.body||{},c=t.contentType||"application/json",s=t.retries,l=t.async||!1,u=t.withCredentials||!1;r="undefined"==typeof document||t.secure?"https://"+r:("https:"===document.location.protocol?"https://":"http://")+r,i="application/json"===c?JSON.stringify(i):i,"undefined"==typeof XMLHttpRequest&&(XMLHttpRequest=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}throw new Error("This browser does not support XMLHttpRequest.")});try{var p=new XMLHttpRequest;u&&(p.withCredentials=!0)}catch(t){return e.verbose&&e.logging&&console.log("Error completing request: ",t),void("function"==typeof o&&o(!0,null))}p.open(n,r,l),c&&p.setRequestHeader("Content-Type",c),t.authCode&&t.nonce&&t.appGuid?p.setRequestHeader("Authorization",t.appGuid+", "+t.nonce+", "+t.authCode):t.appGuid&&p.setRequestHeader("Authorization",t.appGuid),p.onerror=function(){if(--s>0){e.verbose&&e.logging&&console.log("Error: API call failed at the network level. Attempt:"+(10-s));var n=10-s;t.retries=s;var r=n*n*500;r>6e4&&(r=6e4),setTimeout(function(){a(t,o)},r)}else e.verbose&&e.logging&&console.log("Error: API call failed at the network level (retry limit hit)."),"function"==typeof o&&o(!0,null)},p.onload=function(n){if(200!=p.status&&204!=p.status){if(401==p.status&&(e.verbose&&e.logging&&console.log("unauthorzied request"),"function"==typeof o))return void o(!0,p.status);try{var r=(n=JSON.parse(p.responseText)).error,i=n.error_description}catch(e){}if(--s>0){e.verbose&&e.logging&&console.log("Error ("+p.status+")("+r+"): "+i);var c=10-s;t.retries=s;var l=c*c*500;l>6e4&&(l=6e4),setTimeout(function(){a(t,o)},l)}else e.verbose&&e.logging&&console.log("Error (retry limit hit) ("+p.status+")("+r+"): "+i),"function"==typeof o&&o(!0,n)}else if(e.verbose&&e.logging&&console.log("event sent successfully"),"function"==typeof o){try{n=JSON.parse(p.responseText)}catch(e){n=p.responseText}o(!1,n)}},p.send(i)},c=function(){var e="";return"undefined"!=typeof location&&(e=(e=location.pathname.substring(1)).replace(/\/+$/,"")),""==e?"/":e},s=function(){return"undefined"!=typeof navigator?navigator.userAgent:""},l=function(){return"undefined"!=typeof navigator?navigator.language:""},u=function(){return"undefined"!=typeof window?window.screen.availWidth:null},p=function(){return"undefined"!=typeof window?window.screen.availHeight:null},d=function(){return"undefined"!=typeof window?window.innerWidth<window.innerHeight?"portrait":"landscape":""},g=function(e,t){var o=y(e);return""==o?o=v(t):f(t,o),null===o?"":o},v=function(e){if("undefined"==typeof localStorage)return"";var t;try{t=localStorage.getItem(e)}catch(e){return""}return null===t?"":t},f=function(e,t){if("undefined"==typeof localStorage)return!1;try{localStorage.setItem(e,t)}catch(e){return!1}return!0},y=function(e){if("undefined"==typeof location||void 0===location.search)return"";e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},h=function(){var e=m();return f("kv_id",e),e},m=function(){var e=(new Date).getTime();return"kwxxxxxxxxxxxxx".replace(/[xy]/g,function(t){var o=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?o:3&o|8).toString(16)})};if("undefined"!=typeof exports&&(exports.Kochava=r),n)for(;args=n.shift();){var k=args.shift();(i=t[k])&&i.constructor&&i.call&&i.apply&&t[k].apply(this,args)}}();